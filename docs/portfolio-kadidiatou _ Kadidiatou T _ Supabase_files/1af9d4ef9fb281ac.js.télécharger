;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="8170a09e-4533-54cd-13e4-cf4ffb2e7b29")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,166926,e=>{"use strict";var t=e.i(478902),s=e.i(202584),a=e.i(645388),n=e.i(346428),i=e.i(389959),r=e.i(158639),l=e.i(356003);e.i(128328);var o=e.i(86086),d=e.i(947748),c=e.i(657588),u=e.i(601224),h=e.i(215618),m=e.i(915083),p=e.i(805303),x=e.i(300475),g=e.i(234745),f=e.i(915993),j=e.i(150671),b=e.i(617361),y=e.i(774184),S=e.i(162082),w=e.i(552423),N=e.i(265735),v=e.i(635494),C=e.i(541561),T=e.i(10429),_=e.i(887093),E=e.i(48189),L=e.i(432478),k=e.i(908937),R=e.i(283342),q=e.i(774803),I=e.i(308777),A=e.i(355901),D=e.i(317040),M=e.i(189329),P=e.i(201461),Q=e.i(441081),z=e.i(739409),K=e.i(63519),O=e.i(837710),F=e.i(843778),V=e.i(874311),$=e.i(725805),B=e.i(613580),G=e.i(106796),U=e.i(479095),H=e.i(466472);let Y=({visible:e,hasDestructiveOperations:s,hasUpdateWithoutWhere:a,onCancel:n,onConfirm:i})=>(0,t.jsxs)(H.default,{visible:e,size:"large",title:`Potential issue${s&&a?"s":""} detected with your query`,confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:s&&a?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:n,onConfirm:i,children:[(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[s&&(0,t.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,t.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,t.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),s&&a&&(0,t.jsx)(U.Separator,{}),a&&(0,t.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,t.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,t.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,t.jsx)("code",{className:"text-code-inline",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,t.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]});var W=e.i(260305),X=e.i(210928),Z=e.i(888738),J=e.i(884892);function ee(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function et(e){return e!=e.toLowerCase()?`"${e}"`:e}var es=e.i(869922),ea=e.i(242882),en=e.i(714403),ei=e.i(246230);async function er({projectRef:e,connectionString:t},s){let{result:a}=await (0,en.executeSql)({projectRef:e,connectionString:t,sql:`
SELECT word FROM pg_get_keywords();
`.trim(),queryKey:["keywords"]},s);return a.map(e=>e.word.toLocaleLowerCase())}var el=e.i(801834),eo=e.i(926077),ed=e.i(124416),ec=e.i(106579),eu=e.i(420985),eh=e.i(500850),em=e.i(283606),ep=e.i(314805),ex=e.i(408279),eg=e.i(55956),ef=e.i(388019);let ej=(0,ef.default)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var eb=e.i(975924),ey=e.i(215312),eS=e.i(886554),ew=e.i(414833),eN=e.i(587433),ev=e.i(34411),eC=e.i(9679),eT=e.i(451031),e_=e.i(57492),eE=e.i(831927),eL=e.i(156722),ek=e.i(449123),eR=e.i(710483);let eq=["number","string","date"],eI=({results:e={rows:[]},config:s,onConfigChange:n})=>{var l;let o,{ref:c}=(0,r.useParams)(),[u,h]=(0,ed.useLocalStorageQuery)(d.LOCAL_STORAGE_KEYS.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(c),!1),m=(0,i.useMemo)(()=>Object.keys(e.rows[0]||{}).filter(t=>{let s=typeof e.rows[0][t];return eq.includes(s)}),[e]),p=(0,i.useMemo)(()=>e.rows[0]?Object.keys(e.rows[0]).filter(t=>{let s=e.rows[0][t];return"number"==typeof s||!isNaN(Number(s))}):[],[e]),x=s.xKey&&s.yKey,g=(0,i.useMemo)(()=>{if(!x)return!1;let t=typeof e.rows[0]?.[s.xKey],a=typeof e.rows[0]?.[s.yKey];return"number"===t&&"number"===a},[x,e.rows,s.xKey,s.yKey]),f=(0,i.useMemo)(()=>e?.rows?.length?e.rows.reduce((e,t)=>{let a=e[e.length-1]||{};return[...e,{...t,[s.yKey]:(a[s.yKey]||0)+t[s.yKey]}]},[]):[],[e,s]),j=s.cumulative?f:e.rows,b=(l=s.xKey,"number"==typeof(o=j?.[0]?.[l]||"")?"number":(0,eg.default)(o).isValid()?"date":"string");return m.length?(0,t.jsxs)($.ResizablePanelGroup,{direction:"horizontal",className:"flex-grow h-full",children:[(0,t.jsx)($.ResizablePanel,{className:"p-4 h-full",defaultSize:75,children:x?"bar"===s.type?(0,t.jsx)(eS.default,{showLegend:!0,size:"normal",xAxisIsDate:"date"===b,data:j,xAxisKey:s.xKey,yAxisKey:s.yKey,showGrid:s.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!s.showLabels,tickFormatter:e=>{let t=j[+e][s.xKey];return"date"===b?(0,eg.default)(t).format("MMM D YYYY HH:mm"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!s.showLabels,domain:[0,"dataMax"]}}):null:(0,t.jsx)($.ResizablePanel,{className:"p-4 h-full",defaultSize:75,children:(0,t.jsx)(ew.default,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})})}),(0,t.jsx)($.ResizableHandle,{withHandle:!0}),(0,t.jsxs)($.ResizablePanel,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,t.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),s.xKey&&s.yKey&&(0,t.jsx)(ey.ButtonTooltip,{type:"text",size:"tiny",onClick:()=>{let e=s.xKey,t=s.yKey;n({...s,xKey:t,yKey:e})},disabled:!g,icon:(0,t.jsx)(ej,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:g?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),!u&&(0,t.jsxs)(eR.Admonition,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{onClick:()=>h(!0),className:"absolute top-3 right-3 opacity-30 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(eb.X,{size:14,className:"text-foreground-light"})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",children:"Dismiss"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(eN.Badge,{variant:"success",children:"New"}),(0,t.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,t.jsx)("p",{className:"text-xs text-foreground-light !mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,t.jsx)(O.Button,{asChild:!0,size:"tiny",type:"default",className:"mt-1",children:(0,t.jsx)(a.default,{href:`/project/${c}/reports`,children:"Head to Reports"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eC.Label_Shadcn_,{className:"text-xs text-foreground-light",children:"X Axis"}),(0,t.jsxs)(ek.Select_Shadcn_,{value:s.xKey,onValueChange:e=>{n({...s,xKey:e})},children:[(0,t.jsx)(eL.SelectTrigger_Shadcn_,{children:s.xKey||"Select X Axis"}),(0,t.jsx)(eT.SelectContent_Shadcn_,{children:(0,t.jsx)(e_.SelectGroup_Shadcn_,{children:m.map(e=>(0,t.jsx)(eE.SelectItem_Shadcn_,{value:e,children:e},e))})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eC.Label_Shadcn_,{className:"text-xs text-foreground-light",children:"Y Axis"}),(0,t.jsxs)(ek.Select_Shadcn_,{value:s.yKey,onValueChange:e=>{n({...s,yKey:e})},children:[(0,t.jsx)(eL.SelectTrigger_Shadcn_,{children:s.yKey||"Select Y Axis"}),(0,t.jsx)(eT.SelectContent_Shadcn_,{children:(0,t.jsx)(e_.SelectGroup_Shadcn_,{children:p.map(e=>(0,t.jsx)(eE.SelectItem_Shadcn_,{value:e,children:e},e))})})]})]}),(0,t.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,t.jsxs)(eC.Label_Shadcn_,{className:"",htmlFor:"cumulative",children:[(0,t.jsx)(ev.Checkbox_Shadcn_,{id:"cumulative",name:"cumulative",checked:s.cumulative,onClick:()=>n({...s,cumulative:!s.cumulative})}),"Cumulative"]}),(0,t.jsxs)(eC.Label_Shadcn_,{htmlFor:"showLabels",children:[(0,t.jsx)(ev.Checkbox_Shadcn_,{id:"showLabels",name:"showLabels",checked:s.showLabels,onClick:()=>n({...s,showLabels:!s.showLabels})}),"Show labels"]}),(0,t.jsxs)(eC.Label_Shadcn_,{htmlFor:"showGrid",children:[(0,t.jsx)(ev.Checkbox_Shadcn_,{id:"showGrid",name:"showGrid",checked:s.showGrid,onClick:()=>n({...s,showGrid:!s.showGrid})}),"Show grid"]})]})]})]}):(0,t.jsx)("div",{className:"p-2",children:(0,t.jsx)(ew.default,{size:"normal",description:"Execute a query and configure the chart options."})})};var eA=e.i(419524),eD=e.i(370410),eM=e.i(718726);let eP=(0,ef.default)("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);var eQ=e.i(471998),ez=e.i(686415),eK=e.i(282492),eO=e.i(362988),eF=e.i(867637),eV=e.i(740010);let e$=({id:e})=>{let{profile:s}=(0,L.useProfile)(),a=(0,z.useSqlEditorV2StateSnapshot)().snippets[e],n=s?.id===a?.snippet.owner_id;return(0,t.jsx)(t.Fragment,{children:n?null:(0,t.jsx)(eN.Badge,{children:"Read-only"})})},eB=({id:e})=>{let{profile:a}=(0,L.useProfile)(),n=(0,z.useSqlEditorV2StateSnapshot)(),r=n.savingStates[e],l=(0,s.usePrevious)(r),[o,d]=(0,i.useState)(!1),c=n.snippets[e],u=a?.id===c?.snippet.owner_id;return(0,i.useEffect)(()=>{let e=!1;return"UPDATING"===l&&"IDLE"===r&&(d(!0),setTimeout(()=>{e||d(!1)},5e3)),()=>{e=!0}},[r]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[u&&"UPDATING_FAILED"===r&&(0,t.jsx)(O.Button,{type:"text",size:"tiny",icon:(0,t.jsx)(eV.RefreshCcw,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>n.addNeedsSaving(e),children:"Retry"}),o?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eD.Check,{className:"text-brand",size:14,strokeWidth:3})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===r?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(q.Loader2,{className:"animate-spin",size:14,strokeWidth:2})}),(0,t.jsx)(B.TooltipContent,{children:"Saving changes..."})]}):"UPDATING_FAILED"===r?u?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eF.AlertCircle,{className:"text-red-900",size:14,strokeWidth:2})}),(0,t.jsx)(B.TooltipContent,{children:"Failed to save changes"})]}):(0,t.jsx)(e$,{id:e}):null]})})},eG=({id:e,isExecuting:s=!1,isDisabled:a=!1,hasSelection:n=!1,prettifyQuery:i,executeQuery:l})=>{let{ref:o}=(0,r.useParams)(),c=(0,z.useSqlEditorV2StateSnapshot)(),[u]=(0,ed.useLocalStorageQuery)(d.LOCAL_STORAGE_KEYS.SQL_EDITOR_AI_OPEN,!0),[h,m]=(0,ed.useLocalStorageQuery)(d.LOCAL_STORAGE_KEYS.SQL_EDITOR_INTELLISENSE,!0),[p,x]=(0,ed.useLocalStorageQuery)(d.LOCAL_STORAGE_KEYS.SQL_EDITOR_LAST_SELECTED_DB(o),""),g=c.snippets[e],f=void 0!==g&&g.snippet.favorite,j=()=>{m(!h),A.toast.success(`Successfully ${h?"disabled":"enabled"} intellisense. ${h?"Please refresh your browser for changes to take place.":""}`)},b=()=>c.addFavorite(e),y=()=>c.removeFavorite(e);return(0,t.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2",children:[T.IS_PLATFORM&&(0,t.jsx)(eB,{id:e}),(0,t.jsxs)(V.DropdownMenu,{children:[(0,t.jsx)(V.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(O.Button,{"data-testid":"sql-editor-utility-actions",type:"default",className:(0,F.cn)("px-1",u?"block 2xl:hidden":"hidden"),icon:(0,t.jsx)(eQ.MoreVertical,{className:"text-foreground-light"})})}),(0,t.jsxs)(V.DropdownMenuContent,{className:"w-48",children:[(0,t.jsxs)(V.DropdownMenuItem,{className:"justify-between",onClick:j,children:[(0,t.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(eP,{size:14,className:"text-foreground-light"}),"Intellisense enabled"]}),h&&(0,t.jsx)(eD.Check,{className:"text-brand",size:16})]}),T.IS_PLATFORM&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.DropdownMenuSeparator,{}),(0,t.jsxs)(V.DropdownMenuItem,{className:"gap-x-2",onClick:()=>{f?y():b()},children:[(0,t.jsx)(eM.Heart,{size:14,strokeWidth:2,className:f?"fill-brand stroke-none":"fill-none stroke-foreground-light"}),f?"Remove from":"Add to"," favorites"]})]}),(0,t.jsxs)(V.DropdownMenuItem,{className:"gap-x-2",onClick:i,children:[(0,t.jsx)(eA.AlignLeft,{size:14,strokeWidth:2,className:"text-foreground-light"}),"Prettify SQL"]})]})]}),(0,t.jsxs)("div",{className:(0,F.cn)("items-center gap-x-2",u?"hidden 2xl:flex":"flex"),children:[(0,t.jsxs)(V.DropdownMenu,{children:[(0,t.jsx)(V.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(O.Button,{type:"text",className:"px-1",icon:(0,t.jsx)(eP,{className:"text-foreground-light"})})}),(0,t.jsx)(V.DropdownMenuContent,{className:"w-48",children:(0,t.jsxs)(V.DropdownMenuItem,{className:"justify-between",onClick:j,children:["Intellisense enabled",h&&(0,t.jsx)(eD.Check,{className:"text-brand",size:16})]})})]}),T.IS_PLATFORM&&(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:f?(0,t.jsx)(O.Button,{type:"text",size:"tiny",onClick:y,className:"px-1",icon:(0,t.jsx)(eM.Heart,{className:"fill-brand stroke-none"})}):(0,t.jsx)(O.Button,{type:"text",size:"tiny",onClick:b,className:"px-1",icon:(0,t.jsx)(eM.Heart,{className:"fill-none stroke-foreground-light"})})}),(0,t.jsxs)(B.TooltipContent,{side:"bottom",children:[f?"Remove from":"Add to"," favorites"]})]}),(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(O.Button,{type:"text",onClick:i,className:"px-1",icon:(0,t.jsx)(eA.AlignLeft,{strokeWidth:2,className:"text-foreground-light"})})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",children:"Prettify SQL"})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,t.jsxs)("div",{className:"flex items-center",children:[T.IS_PLATFORM&&(0,t.jsx)(eK.DatabaseSelector,{selectedDatabaseId:0===p.length?void 0:p,variant:"connected-on-right",onSelectId:t=>{c.resetResults(e),x(t)}}),(0,t.jsx)(ez.RoleImpersonationPopover,{serviceRoleLabel:"postgres",variant:T.IS_PLATFORM?"connected-on-both":"connected-on-right"}),(0,t.jsx)(eO.SqlRunButton,{hasSelection:n,isDisabled:a||s,isExecuting:s,className:"rounded-l-none min-w-[82px]",onClick:l})]})})]})};var eU=e.i(223600),eH=e.i(867987),eY=e.i(454370),eW=e.i(543851),eX=e.i(382490);function eZ({mode:e,onToggleMode:s,summary:a,id:n,rows:i}){let r="visual"===e,l=(0,z.useSqlEditorV2StateSnapshot)(),{openSidebar:o}=(0,Q.useSidebarManagerSnapshot)(),d=(0,D.useAiAssistantStateSnapshot)(),c=()=>{if(!n)return null;let e=l.snippets[n]?.snippet;return e?.content?.sql?function({sql:e,explainPlanRows:t}){let s=t.map(e=>e["QUERY PLAN"]).join("\n"),a=`Explain this PostgreSQL EXPLAIN ANALYZE output in simple terms:

\`\`\`sql
${e}
\`\`\`

\`\`\`
${s}
\`\`\`

Format your response with:

**What it does** - 1-2 sentences.

**How it runs** - Briefly explain the plan from bottom to top in plain English. Mention key operations (scans, joins, sorts) and why PostgreSQL chose them.

**Issues** - Identify bottlenecks: slowest steps, sequential scans on large tables, inefficient joins, missing indexes. Be specific with timings from the plan.

**Fixes** - 2-3 specific suggestions with CREATE INDEX statements if applicable.

Keep it concise. Focus on actionable insights.`;return{query:e,prompt:a}}({sql:e.content.sql,explainPlanRows:i??[]}):null},u=r&&a&&(a.totalTime>0||a.hasSeqScan&&!a.hasIndexScan);return(0,t.jsx)("div",{className:"bg-surface-100 border-b px-4 py-3 flex flex-col gap-3 text-xs",children:(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground",children:"Query Execution Plan"}),(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eX.HelpCircle,{size:"14",strokeWidth:2,className:"text-foreground-lighter hover:text-foreground-light transition-colors cursor-help"})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs p-4",children:[(0,t.jsx)("h3",{className:"text-xs font-medium mb-2",children:"How to read"}),(0,t.jsx)("p",{className:"text-foreground-light text-xs",children:"Start at the bottom where data is read from tables, then follow upward as each step processes the results."}),r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"text-xs font-medium mt-4 mb-2",children:"Key"}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 text-foreground-light",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-warning"}),(0,t.jsx)("span",{children:"Seq Scan (slow)"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-brand"}),(0,t.jsx)("span",{children:"Index Scan (fast)"})]})]})]})]})]}),u&&(0,t.jsx)("div",{className:"flex items-center gap-4 flex-wrap",children:a.totalTime>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-foreground-muted",children:"/"}),(0,t.jsx)("span",{className:"text-foreground-light",children:"Total time"}),(0,t.jsxs)("span",{className:"font-medium text-foreground",children:[a.totalTime.toFixed(2),"ms"]})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[n&&i&&(0,t.jsx)(eH.AiAssistantDropdown,{label:"Explain with AI",buildPrompt:()=>{let e=c();return e?`${e.prompt}

SQL Query:
\`\`\`sql
${e.query}
\`\`\``:""},onOpenAssistant:()=>{let e=c();e&&(o(h.SIDEBAR_KEYS.AI_ASSISTANT),d.newChat({sqlSnippets:[{label:"Query",content:e.query}],initialMessage:e.prompt}))},telemetrySource:"explain_visualizer",size:"tiny",type:"default"}),(0,t.jsx)(O.Button,{type:"default",size:"tiny",icon:r?(0,t.jsx)(eY.Code,{size:14}):(0,t.jsx)(eW.Eye,{size:14}),onClick:s,children:r?"Raw":"Visual"})]})]})})}var eJ=e.i(416050),e0=e.i(88816),e1=e.i(710377);function e2(e){return void 0===e?"-":e.toLocaleString()}function e4({actualRows:e,estimatedRows:s,rowsRemovedByFilter:a}){let n=void 0!==e,i=void 0!==s,r=void 0!==a&&n,l=r?e+a:void 0;return r&&void 0!==l?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 cursor-help",children:[(0,t.jsx)("span",{className:"text-foreground-light",children:e2(l)}),(0,t.jsx)(e1.ArrowRight,{size:10,className:"text-foreground-muted"}),(0,t.jsxs)("span",{className:"text-destructive-600 font-medium",children:["-",e2(a)]}),(0,t.jsx)(e1.ArrowRight,{size:10,className:"text-foreground-muted"}),(0,t.jsxs)("span",{className:"text-brand font-medium",children:[e2(e)," ",1===e?"row":"rows"]})]})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsx)("p",{className:"font-medium",children:"Filter applied"}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:[e2(l)," rows were scanned,"," ",e2(a)," were filtered out, leaving"," ",e2(e)," rows. Consider adding an index to reduce rows scanned."]})]})]}):n?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("span",{className:"text-foreground-light cursor-help",children:[e2(e)," ",1===e?"row":"rows"]})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsx)("p",{className:"font-medium",children:"Rows returned"}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:["This operation processed and returned ",e2(e)," rows."]})]})]}):i?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("span",{className:"text-foreground-muted cursor-help",children:["est. ",e2(s)," ",1===s?"row":"rows"]})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsx)("p",{className:"font-medium",children:"Estimated rows"}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:["The planner estimates this operation will return ",e2(s)," rows. Run with EXPLAIN ANALYZE to see actual row counts."]})]})]}):(0,t.jsx)("span",{className:"text-foreground-muted",children:"-"})}var e3=e.i(591052);function e8({node:e,depth:s,maxDuration:a}){let[n,r]=(0,i.useState)(!1),l=e.children.length>0,o=!!e.details?.trim(),d=(0,e3.parseDetailLines)(e.details),c=24*s,h=e.actualTime?e.actualTime.end-e.actualTime.start:0,m=e.actualTime&&h>0,p=a>0?h/a*100:0,x=(0,u.getScanBarColor)(e.operation),g=(0,u.getScanBorderColor)(e.operation);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"group",children:[(0,t.jsxs)("div",{className:(0,F.cn)("flex items-stretch border-l-4 transition-colors bg-studio group-hover:bg-surface-100/50",g),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 shrink-0 min-w-[400px]",style:{paddingLeft:`${16+c}px`},children:[(0,t.jsx)("button",{type:"button",onClick:()=>o&&r(!n),disabled:!o,className:(0,F.cn)("flex items-center justify-center w-5 h-5 rounded border border-border-muted shrink-0",o?"hover:bg-surface-200 cursor-pointer":"opacity-30 cursor-default"),"aria-label":n?"Collapse details":"Expand details",children:n?(0,t.jsx)(e0.ChevronDown,{size:12,className:"text-foreground-light"}):(0,t.jsx)(eJ.ChevronRight,{size:12,className:"text-foreground-light"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 font-mono text-xs min-w-0",children:[(0,t.jsx)("span",{className:"text-foreground uppercase font-medium whitespace-nowrap",children:e.operation}),(0,t.jsxs)("span",{className:"text-foreground-muted whitespace-nowrap",children:["(cost ",e.cost?.end?.toFixed(1)??"-",", estimated"," ",e.rows?.toLocaleString()??"?"," ",1===e.rows?"row":"rows",")"]})]})]}),(0,t.jsx)("div",{className:"flex-1 relative min-h-[43px] flex items-center",children:m&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:(0,F.cn)("absolute left-0 top-0 h-full",x),style:{width:`${p}%`}}),(0,t.jsxs)("div",{className:"relative flex items-center gap-2 font-mono text-xs whitespace-nowrap px-3",children:[(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"text-foreground-light cursor-help",children:(0,u.formatNodeDuration)(h)})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsxs)("p",{className:"font-medium",children:["Execution time: ",(0,u.formatNodeDuration)(h)]}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:["This is how long this operation took to execute. The bar width shows this as a percentage of the slowest operation (",Math.round(p),"%) â€” wider bars indicate where more time is spent."]})]})]}),(0,t.jsx)("span",{className:"text-foreground-muted",children:"/"}),(0,t.jsx)(e4,{actualRows:e.actualRows,estimatedRows:e.rows,rowsRemovedByFilter:e.rowsRemovedByFilter})]})]})})]}),n&&d.length>0&&(0,t.jsx)("div",{className:(0,F.cn)("border-t-border-muted border-t border-l-4 bg-studio group-hover:bg-surface-100/50",g),style:{paddingLeft:`${16+c+32}px`},children:(0,t.jsx)("div",{className:"px-0 py-3 space-y-2 font-mono text-xs",children:d.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-1",children:[e.label&&(0,t.jsx)("span",{className:"text-foreground-muted",children:e.label}),(0,t.jsx)("span",{className:"text-foreground-light break-all",children:e.value})]},s))})})]}),l&&e.children.map((e,n)=>(0,t.jsx)(e8,{node:e,depth:s+1,maxDuration:a},n))]})}function e5({rows:e,onShowRaw:s,id:a}){let n=(0,i.useMemo)(()=>(0,e3.createNodeTree)(e),[e]),r=(0,i.useMemo)(()=>(0,e3.calculateMaxDuration)(n),[n]),l=(0,i.useMemo)(()=>(0,e3.calculateSummary)(n),[n]);return 0===n.length?(0,t.jsx)("div",{className:"bg-studio",children:(0,t.jsx)("p",{className:"m-0 border-0 px-4 py-3 font-mono text-sm text-foreground-light",children:"No execution plan data available"})}):(0,t.jsxs)("div",{className:"bg-studio h-full flex flex-col min-h-0",children:[s&&(0,t.jsx)(eZ,{mode:"visual",onToggleMode:s,summary:l,id:a,rows:e}),(0,t.jsx)("div",{className:"flex-1 overflow-auto min-h-0",children:(0,t.jsx)("div",{className:"flex flex-col min-w-max pb-1 divide-y divide-border-muted",children:n.map((e,s)=>(0,t.jsx)(e8,{node:e,depth:0,maxDuration:r},s))})})]})}var e6=e.i(198088);function e7({id:e,isExecuting:s}){let a=(0,z.useSqlEditorV2StateSnapshot)().explainResults[e],[n,r]=(0,i.useState)("visual");if(s)return(0,t.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,t.jsx)(q.Loader2,{size:14,className:"animate-spin"}),(0,t.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running EXPLAIN ANALYZE..."})]});if(a?.error){let e=(a.error?.formattedError?.split("\n")??[]).filter(e=>e.length>0);return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4 pb-9",children:[(0,t.jsx)("div",{className:"flex flex-col gap-y-1",children:e.length>0?e.map((e,s)=>(0,t.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},`error-${s}`)):(0,t.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",a.error?.message]})}),(0,t.jsx)("div",{className:"flex items-center gap-x-2",children:e.length>0&&(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eU.default,{iconOnly:!0,type:"default",text:e.join("\n")})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",align:"center",children:(0,t.jsx)("span",{children:"Copy error"})})]})})]})})}if(!a||0===a.rows.length)return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsx)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:"No execution plan available. The query will be analyzed when you switch to this tab."})});let l=(0,u.isExplainQuery)(a.rows),o=(0,u.isTextFormatExplain)(a.rows);if(!l)return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsx)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:"Unable to parse explain results. Please try running the query again."})});if(!o)return(0,t.jsxs)("div",{className:"h-full flex flex-col pb-9",children:[(0,t.jsx)("div",{className:"px-4 py-3 bg-surface-100 border-b border-default flex items-center gap-2",children:(0,t.jsx)("span",{className:"text-sm text-foreground-light",children:"Visual execution plan is only available for TEXT format. Showing raw output."})}),(0,t.jsx)(e6.default,{rows:a.rows})]});let d=()=>r("visual"===n?"raw":"visual");return(0,t.jsx)("div",{className:"h-full flex flex-col pb-9",children:"visual"===n?(0,t.jsx)(e5,{rows:a.rows,onShowRaw:d,id:e}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eZ,{mode:"raw",onToggleMode:d,id:e,rows:a.rows}),(0,t.jsx)(e6.default,{rows:a.rows})]})})}var e9=e.i(743371),te=e.i(937942),tt=e.i(377451),ts=e.i(540203),ta=e.i(17203),tn=e.i(645974);let ti=(0,i.forwardRef)(({id:e,isExecuting:s,isDisabled:a,isDebugging:n,onDebug:i,buildDebugPrompt:l})=>{let{ref:o}=(0,r.useParams)(),d=(0,M.useDatabaseSelectorStateSnapshot)(),{data:c}=(0,N.useSelectedOrganizationQuery)(),u=(0,z.useSqlEditorV2StateSnapshot)(),[,h]=(0,tn.useQueryState)("showConnect",tn.parseAsBoolean.withDefault(!1)),m=u.results[e]?.[0],{data:p}=(0,ts.useOrgSubscriptionQuery)({orgSlug:c?.slug}),{data:x}=(0,tt.useProjectSettingsV2Query)({projectRef:o}),g=(0,e9.subscriptionHasHipaaAddon)(p)&&x?.is_sensitive,f=m?.error?.message?.includes("canceling statement due to statement timeout")||m?.error?.message?.includes("upstream request timeout")||m?.error?.message?.includes("Query read timeout"),j=m?.error?.message?.includes("EHOSTUNREACH");if(s)return(0,t.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,t.jsx)(q.Loader2,{size:14,className:"animate-spin"}),(0,t.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(m?.error){let s=(m.error?.formattedError?.split("\n")??[]).filter(e=>e.length>0),r=d.selectedDatabaseId!==o&&m.error.message.includes("in a read-only transaction"),c=m.error.message.includes("Query is too large to be run via the SQL Editor");return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[f?(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("p",{className:"font-mono text-sm tracking-tight",children:"Error: SQL query ran into an upstream timeout"}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["You can either"," ",(0,t.jsx)(te.InlineLink,{href:`${T.DOCS_URL}/guides/platform/performance#examining-query-performance`,children:"optimize your query"}),", or"," ",(0,t.jsx)(te.InlineLink,{href:`${T.DOCS_URL}/guides/database/timeouts`,children:"increase the statement timeout"})," or ",(0,t.jsx)("span",{className:(0,F.cn)(te.InlineLinkClassName,"cursor-pointer"),onClick:()=>h(!0),children:"connect to your database directly"}),"."]})]}):(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[s.length>0?s.map((e,s)=>(0,t.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},`error-${s}`)):(0,t.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",m.error?.message]}),!f&&!j&&m.autoLimit&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",m.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),r&&(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),c&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,t.jsxs)("span",{onClick:()=>h(!0),className:(0,F.cn)(te.InlineLinkClassName,"flex items-center gap-x-1"),children:["connecting to your database directly",(0,t.jsx)(ta.ExternalLink,{size:12})]}),"."]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[r&&(0,t.jsx)(O.Button,{className:"py-2",type:"default",onClick:()=>{d.setSelectedDatabaseId(o),u.resetResults(e)},children:"Switch to primary database"}),s.length>0&&(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eU.default,{iconOnly:!0,type:"default",text:s.join("\n")})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",align:"center",children:(0,t.jsx)("span",{children:"Copy error"})})]}),!g&&(0,t.jsx)(eH.AiAssistantDropdown,{label:"Debug with Assistant",buildPrompt:l,onOpenAssistant:i,telemetrySource:"sql_debug",disabled:!!a||n,loading:n})]})]})})}return m?m.rows.length<=0?(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,t.jsx)(e6.default,{rows:m.rows}):(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,t.jsx)("code",{children:"Run"})," to execute your query."]})})});ti.displayName="UtilityTabResults";let tr={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1},tl=({id:e,isExecuting:s,isExplainExecuting:a,isDebugging:n,isDisabled:i,hasSelection:l,prettifyQuery:o,executeQuery:d,executeExplainQuery:u,onDebug:h,buildDebugPrompt:m,activeTab:p="results",onActiveTabChange:x})=>{let{ref:g}=(0,r.useParams)(),{data:f}=(0,N.useSelectedOrganizationQuery)(),j=(0,z.useSqlEditorV2StateSnapshot)(),b=(0,c.useFlag)("ShowPrettyExplain"),y=j.snippets[e]?.snippet,w=j.results[e]?.[0],{mutate:v}=(0,S.useSendEventMutation)(),{mutate:C}=(0,eu.useContentUpsertMutation)({invalidateQueriesOnSuccess:!1,onMutate:async t=>{let{payload:s}=t;if("sql"!==s.type||!("chart"in s.content))return;let a={...y,content:{...y.content,chart:s.content.chart}};j.updateSnippet({id:e,snippet:a})},onError:async(e,t,s)=>{A.toast.error("Failed to update chart. Please try again.")}}),T=y&&"sql"===y.type&&y.content?.chart?y.content.chart:tr;return(0,t.jsxs)(eh.Tabs_Shadcn_,{value:p,onValueChange:e=>{"explain"===e&&u(),x?.(e)},className:"w-full h-full flex flex-col",children:[(0,t.jsxs)(ep.TabsList_Shadcn_,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(ex.TabsTrigger_Shadcn_,{className:"py-3 text-xs",value:"results",children:(0,t.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),b&&(0,t.jsx)(ex.TabsTrigger_Shadcn_,{className:"py-3 text-xs",value:"explain",children:(0,t.jsx)("span",{className:"translate-y-[1px]",children:"Explain"})}),(0,t.jsx)(ex.TabsTrigger_Shadcn_,{className:"py-3 text-xs",value:"chart",children:(0,t.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),w?.rows&&(0,t.jsx)(ec.DownloadResultsButton,{type:"text",results:w.rows,fileName:`Supabase Snippet ${y.name}`,onDownloadAsCSV:()=>v({action:"sql_editor_result_download_csv_clicked",groups:{project:g??"",organization:f?.slug??""}}),onCopyAsMarkdown:()=>{v({action:"sql_editor_result_copy_markdown_clicked",groups:{project:g??"",organization:f?.slug??""}})},onCopyAsJSON:()=>{v({action:"sql_editor_result_copy_json_clicked",groups:{project:g??"",organization:f?.slug??""}})}})]}),(0,t.jsx)(eG,{id:e,isExecuting:s,isDisabled:i,hasSelection:l,prettifyQuery:o,executeQuery:d})]}),(0,t.jsx)(em.TabsContent_Shadcn_,{asChild:!0,value:"results",className:"mt-0 flex-grow",children:(0,t.jsx)(ti,{id:e,isExecuting:s,isDisabled:i,onDebug:h,buildDebugPrompt:m,isDebugging:n})}),b&&(0,t.jsx)(em.TabsContent_Shadcn_,{asChild:!0,value:"explain",className:"mt-0 flex-grow",children:(0,t.jsx)(e7,{id:e,isExecuting:a})}),(0,t.jsx)(em.TabsContent_Shadcn_,{asChild:!0,value:"chart",className:"mt-0 flex-grow",children:(0,t.jsx)(eI,{results:w,config:T,onConfigChange:function(t){g&&y?.id&&C({projectRef:g,payload:{...y,id:y.id,description:y.description||"",project_id:y.project_id||0,content:{...y.content,content_id:e,chart:t}}})}})})]})},to=(0,I.default)(()=>e.A(281524),{loadableGenerated:{modules:[496981]},ssr:!1}),td=(0,I.default)(()=>e.A(836681).then(({DiffEditor:e})=>e),{loadableGenerated:{modules:[975826]},ssr:!1}),tc=()=>{let e=(0,E.detectOS)(),s=(0,n.useRouter)(),{ref:a,id:I}=(0,r.useParams)(),{profile:U}=(0,L.useProfile)(),{data:H}=(0,v.useSelectedProjectQuery)(),{data:en}=(0,N.useSelectedOrganizationQuery)(),ec=(0,l.useQueryClient)(),eu=(0,K.useTabsStateSnapshot)(),eh=(0,D.useAiAssistantStateSnapshot)(),{openSidebar:em}=(0,Q.useSidebarManagerSnapshot)(),ep=(0,z.useSqlEditorV2StateSnapshot)(),ex=(0,P.useGetImpersonatedRoleState)(),eg=(0,M.useDatabaseSelectorStateSnapshot)(),{isHipaaProjectDisallowed:ef}=(0,w.useOrgAiOptInLevel)(),ej=(0,c.useFlag)("ShowPrettyExplain"),{sourceSqlDiff:eb,setSourceSqlDiff:ey,selectedDiffType:eS,setSelectedDiffType:ew,setIsAcceptDiffLoading:eN,isDiffOpen:ev,defaultSqlDiff:eC,closeDiff:eT}=(0,G.useSqlEditorDiff)(),{promptState:e_,setPromptState:eE,promptInput:eL,setPromptInput:ek,resetPrompt:eR}=(0,G.useSqlEditorPrompt)(),eq=(0,i.useRef)(null),eI=(0,i.useRef)(null),eA=(0,i.useRef)(null),eD=(0,i.useRef)(0),[eM,eP]=(0,i.useState)(!1),[eQ,ez]=(0,i.useState)([]),[eK,eO]=(0,i.useState)(!1),[eF,eV]=(0,i.useState)(!1),[e$,eB]=(0,i.useState)(!1),[eG,eU]=(0,i.useState)(!1),[eH,eY]=(0,i.useState)(!1),[eW,eX]=(0,i.useState)("results"),[eZ,eJ]=(0,i.useMemo)(()=>{let e=(0,W.generateSnippetTitle)();return[e,(0,C.generateUuid)([`${e}.sql`])]},[I]),e0=I&&"new"!==I?I:eJ,e1=ep.limit,e2=ep.results[e0]?.[0],e4=!(e0 in ep.snippets&&void 0!==ep.snippets[e0].snippet.content),e3="new"!==I&&e4;((e,t)=>{let{data:s}=(0,v.useSelectedProjectQuery)(),a=(0,z.useSqlEditorV2StateSnapshot)(),[n]=(0,ed.useLocalStorageQuery)(d.LOCAL_STORAGE_KEYS.SQL_EDITOR_INTELLISENSE,!0),{data:r,isSuccess:l}=(({projectRef:e,connectionString:t},{enabled:s=!0,...a}={})=>(0,ea.useQuery)({queryKey:ei.databaseKeys.keywords(e),queryFn:({signal:s})=>er({projectRef:e,connectionString:t},s),enabled:s&&void 0!==e,...a}))({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:n}),{data:o,isSuccess:c}=(0,es.useDatabaseFunctionsQuery)({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:n}),{data:u,isSuccess:h}=(0,el.useSchemasQuery)({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:n}),{data:m,isSuccess:p}=(0,eo.useTableColumnsQuery)({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:n}),x=(0,i.useRef)(null),g=n&&p&&h&&l&&c;g&&(null===x.current&&(x.current={}),x.current.tableColumns=m,x.current.schemas=u,x.current.keywords=r,x.current.functions=o),(0,i.useEffect)(()=>{if(t){let s=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(t){let s=t.getValue(),n=(0,_.formatSql)(s);return e&&a.setSql({id:e,sql:n}),[{range:t.getFullModelRange(),text:n}]}});return()=>s.dispose()}},[t]),(0,i.useEffect)(()=>{let e=null,s=null;g&&t&&g&&(e=t.languages.registerCompletionItemProvider("pgsql",{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(e,s,a){try{let d=new J.default(e,s.column-2,s.lineNumber-1);if('"'===a.triggerCharacter){var n,i,r=t,l=x,o=d;let e=[];if(!o.isFowardDQuote())return{suggestions:e};if(o.next(),o.isNextPeriod()){let t=o.readIdent(),s=!1;t.match(/^\".*?\"$/)&&(s=!0,t=ee(t));let a=l.current.tableColumns.find(e=>s&&e.tablename===t||!s&&e.tablename.toLocaleLowerCase()==t.toLocaleLowerCase());if(!a)return{suggestions:e};a.columns.forEach(t=>{e.push({label:t.attname,kind:r.languages.CompletionItemKind.Property,detail:t.data_type,insertText:t.attname})})}else l.current.tableColumns.forEach(t=>{e.push({label:t.tablename,kind:r.languages.CompletionItemKind.Class,insertText:t.tablename})});return{suggestions:e}}if("."===a.triggerCharacter)return function(e,t,s){var a,n;let i=[],r=(a=s,n=3,a.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=ee(e)),{isQuoted:t,name:e}})),l=0,o=t.current.schemas.find(e=>{let t=r&&r.length>l?r[l]:{};return t.isQuoted&&e.name===t.name||!t.isQuoted&&e.name?.toLocaleLowerCase()==t.name?.toLocaleLowerCase()});if(o?l++:o=t.current.schemas.find(e=>"public"==e.name),r.length==l)return t.current.tableColumns.forEach(t=>{t.schemaname==o.name&&i.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:et(t.tablename)})}),{suggestions:i};let d=t.current.tableColumns.find(e=>{let t=r&&r.length>l?r[l]:{};return e.schemaname==o.name&&t.isQuoted&&e.tablename===t.name||!t.isQuoted&&e.tablename?.toLocaleLowerCase()==t.name?.toLocaleLowerCase()});return d&&d.columns.forEach(t=>{i.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:et(t.attname)})}),{suggestions:i}}(t,x,d);{let e;return n=t,i=x,e=[],i.current.keywords?.length>0&&i.current.keywords.forEach(t=>{e.push({label:t,kind:n.languages.CompletionItemKind.Keyword,insertText:t})}),i.current.schemas?.length>0&&i.current.schemas.forEach(t=>{e.push({label:t.name,kind:n.languages.CompletionItemKind.Keyword,insertText:t.name})}),i.current.tableColumns?.length>0&&i.current.tableColumns.forEach(t=>{let s="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;e.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?n.languages.CompletionItemKind.Class:n.languages.CompletionItemKind.Interface,insertText:et(s)}),t.columns.forEach(s=>{if(!s)return;let a=e.find(e=>e.label===s?.attname&&e.kind===n.languages.CompletionItemKind.Field&&e.detail===s?.data_type);a?(a.tables.push(t.tablename),a.tables.sort(),a.documentation=a.tables.join(", ")):e.push({label:s.attname,kind:n.languages.CompletionItemKind.Field,detail:s.data_type,documentation:t.tablename,tables:[t.tablename],insertText:et(s.attname)})})}),i.current.functions?.length>0&&i.current.functions.forEach(t=>{e.push({label:t.name,kind:n.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:e}}}catch(e){return{suggestions:[]}}}}),s=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let s=new J.default(e,t.column-2,t.lineNumber-1),a=s.readArguments();if(a<0)return null;let n=s.readIdent();if(!n||n.match(/^\".*?\"$/))return null;let i=x.current.functions.find(e=>e.name.toLocaleLowerCase()===n.toLocaleLowerCase());if(!i||!i.args||i.args.length<a)return null;let r=Math.min(a,i.args.length-1),l=[];return l.push({label:`${i.name}(${i.argument_types})`,parameters:i.args.map(e=>({label:e.name}))}),{value:{signatures:l,activeSignature:0,activeParameter:r},dispose:()=>{}}}}));return()=>{e?.dispose(),s?.dispose()}},[g,t])})(e0,eI.current);let{data:e8,isSuccess:e5}=(0,j.useReadReplicasQuery)({projectRef:a},{enabled:(0,g.isValidConnString)(H?.connectionString)}),{mutateAsync:e6}=(0,x.useSqlTitleGenerateMutation)(),{mutate:e7}=(0,S.useSendEventMutation)(),{mutate:e9,isPending:te}=(0,b.useExecuteSqlMutation)({onSuccess(e,t){e0&&(ep.addResult(e0,e.result,t.autoLimit),ej&&(0,u.isExplainQuery)(e.result)?(ep.addExplainResult(e0,e.result),eX("explain")):"explain"===eW&&eX("results")),ec.invalidateQueries({queryKey:f.lintKeys.lint(a)})},onError(e,t){if(e0){if(e.position&&eI.current){let t=eq.current,s=eI.current,a=eM?t?.getSelection()?.startLineNumber??0:0,n=e.formattedError??"",i=n.slice(n.indexOf("LINE")),r=a+Number(i.slice(0,i.indexOf(":")).split(" ")[1]);if(!isNaN(r)){let e=t?.deltaDecorations([],[{range:new s.Range(r,1,r,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(t?.revealLineInCenter(r),ez(e))}}ep.addResultError(e0,e,t.autoLimit)}}}),{mutate:tt,isPending:ts}=(0,b.useExecuteSqlMutation)({onSuccess(e){e0&&(ep.addExplainResult(e0,e.result),eX("explain"))},onError(e){e0&&(ep.addExplainResultError(e0,e),eX("explain"))}}),ta=(0,i.useCallback)(async(e,t)=>{try{let{title:s}=await e6({sql:t});ep.updateSnippet({id:e,snippet:{name:s}}),ep.addNeedsSaving(e);let a=(0,K.createTabId)("sql",{id:e});eu.updateTab(a,{label:s})}catch(e){}},[e6,ep]),tn=(0,i.useCallback)(async()=>{if(ev)return;let e=(0,z.getSqlEditorV2StateSnapshot)().snippets[e0];if(eq.current&&H){let t=eq.current,s=t.getSelection(),a=s?t.getModel()?.getValueInRange(s):void 0,n=e?(a||eq.current?.getValue())??e.snippet.content?.sql:a||eq.current?.getValue(),i=(0,_.formatSql)(n),r=eq?.current?.getModel();eq.current&&r&&(eq.current.executeEdits("apply-prettify-edit",[{text:i,range:r.getFullModelRange()}]),ep.setSql({id:e0,sql:i}))}},[e0,ev,H,ep]),ti=(0,i.useCallback)(async(e=!1)=>{if(ev)return;let t=(0,z.getSqlEditorV2StateSnapshot)().snippets[e0];if(null!==eq.current&&!te&&void 0!==H){let s=eq.current,n=s.getSelection(),i=n?s.getModel()?.getValueInRange(n):void 0,r=t?(i||eq.current?.getValue())??t.snippet.content?.sql:i||eq.current?.getValue(),l=!1,d=(0,Z.checkDestructiveQuery)(r);!e&&d&&(eV(!0),eB(!0),l=!0);let c=(0,Z.isUpdateWithoutWhere)(r);if(!e&&c&&(eV(!0),eU(!0),l=!0),l)return;!ef&&t?.snippet.name.startsWith(W.untitledSnippetTitle)&&o.IS_PLATFORM&&ta(e0,r),eQ.length>0&&(s?.deltaDecorations(eQ,[]),ez([]));let u=ex(),h=e8?.find(e=>e.identifier===eg.selectedDatabaseId)?.connectionString;if(!(0,g.isValidConnString)(h))return A.toast.error("Unable to run query: Connection string is missing");let{appendAutoLimit:m}=(0,Z.checkIfAppendLimitRequired)(r,e1),p=(0,Z.suffixWithLimit)(r,e1);e9({projectRef:H.ref,connectionString:h,sql:(0,k.wrapWithRoleImpersonation)(p,u),autoLimit:m?e1:void 0,isRoleImpersonationEnabled:(0,P.isRoleImpersonationEnabled)(u.role),isStatementTimeoutDisabled:!0,contextualInvalidation:!0,handleError:e=>{throw e}}),e7({action:"sql_editor_query_run_button_clicked",groups:{project:a??"Unknown",organization:en?.slug??"Unknown"}})}},[ev,e0,te,H,ef,e9,ex,ta,eg.selectedDatabaseId,e8,e1]),tr=(0,i.useCallback)(async()=>{if(ev)return;let e=(0,z.getSqlEditorV2StateSnapshot)().snippets[e0];if(null!==eq.current&&!ts&&void 0!==H){let t=eq.current,s=t.getSelection(),a=s?t.getModel()?.getValueInRange(s):void 0,n=e?(a||eq.current?.getValue())??e.snippet.content?.sql:a||eq.current?.getValue();if((0,u.splitSqlStatements)(n).length>1){ep.addExplainResultError(e0,{message:"EXPLAIN only works on a single SQL statement. Please select just one query to analyze."}),eX("explain");return}eQ.length>0&&(t?.deltaDecorations(eQ,[]),ez([]));let i=ex(),r=e8?.find(e=>e.identifier===eg.selectedDatabaseId)?.connectionString;if(!(0,g.isValidConnString)(r))return A.toast.error("Unable to run query: Connection string is missing");let l=(0,u.isExplainSql)(n)?n:`EXPLAIN ANALYZE ${n}`,o=(0,y.wrapWithRollback)((0,k.wrapWithRoleImpersonation)(l,i));tt({projectRef:H.ref,connectionString:r,sql:o,isRoleImpersonationEnabled:(0,P.isRoleImpersonationEnabled)(i.role),handleError:e=>{throw e}})}},[ev,e0,ts,H,tt,ex,eg.selectedDatabaseId,e8,eQ,ep]),tc=(0,i.useCallback)(async(e,t)=>{if(!a)return console.error("Project ref is required");if(!U)return console.error("Profile is required");if(!H)return console.error("Project is required");try{let n=(0,Z.createSqlSnippetSkeletonV2)({name:t,sql:e,owner_id:U.id,project_id:H.id});ep.addSnippet({projectRef:a,snippet:n}),ep.addNeedsSaving(n.id),s.push(`/project/${a}/sql/${n.id}`)}catch(e){A.toast.error(`Failed to create new query: ${e.message}`)}},[U?.id,H?.id,a,s,ep]),tu=(0,i.useCallback)(()=>{let e=ep.snippets[e0],t=ep.results[e0]?.[0],s=(e?.snippet.content?.sql??"").replace(W.sqlAiDisclaimerComment,"").trim(),a=t?.error?.message??"Unknown error",n=`Help me to debug the attached sql snippet which gives the following error: 

${a}`;return`${n}

SQL Query:
\`\`\`sql
${s}
\`\`\``},[e0,ep.results,ep.snippets]),th=(0,i.useCallback)(async()=>{try{let e=ep.snippets[e0],t=ep.results[e0]?.[0];em(h.SIDEBAR_KEYS.AI_ASSISTANT),eh.newChat({name:"Debug SQL snippet",sqlSnippets:[(e.snippet.content?.sql??"").replace(W.sqlAiDisclaimerComment,"").trim()],initialInput:`Help me to debug the attached sql snippet which gives the following error: 

${t.error.message}`})}catch(e){e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message&&A.toast.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[e0,ep.results,ep.snippets]),tm=(0,i.useCallback)(async()=>{try{if(eN(!0),!eb||!eq.current||!eA.current)return;let e=eq.current.getModel(),t=eA.current.getModel();if(!e||!t)return;let s=t.modified.getValue();if(eS===X.DiffType.NewSnippet){let{title:e}=await e6({sql:s});await tc(s,e)}else eq.current.executeEdits("apply-ai-edit",[{text:s,range:e.getFullModelRange()}]);e7({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!0},groups:{project:a??"Unknown",organization:en?.slug??"Unknown"}}),ew(X.DiffType.Modification),eR(),eT()}finally{eN(!1)}},[eb,eS,tc,e6,s,e0,ep]),tp=(0,i.useCallback)(()=>{e7({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!1},groups:{project:a??"Unknown",organization:en?.slug??"Unknown"}}),eR(),eT()},[eT,eR,e7]),[tx,tg]=(0,i.useState)(!1),tf=(0,i.useCallback)(async(e,t)=>{try{tg(!0);let e=await fetch(`${T.BASE_PATH}/api/ai/code/complete`,{method:"POST",headers:{"Content-Type":"application/json",...t?.headers??{}},body:JSON.stringify({projectRef:H?.ref,connectionString:H?.connectionString,language:"sql",orgSlug:en?.slug,...t?.body??{}})});if(!e.ok){let t=await e.text();throw Error(t||"Failed to generate completion")}let s=await e.json(),a=t?.body?.completionMetadata??{},n=a.textBeforeCursor??"",i=a.textAfterCursor??"",r=a.selection??"",l=(0,_.formatSql)(n+s+i);ey({original:n+r+i,modified:l}),ew(X.DiffType.Modification),eE(e=>({...e,isLoading:!1})),tg(!1)}catch(e){throw A.toast.error(`Failed to generate SQL: ${e?.message??"Unknown error"}`),tg(!1),e}},[en?.slug,H?.connectionString,H?.ref,eE,ew,ey]),tj=async(e,t)=>{try{eE(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let s=(await (0,g.constructHeaders)()).get("Authorization");await tf(e,{...s?{headers:{Authorization:s}}:void 0,body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){eE(e=>({...e,isLoading:!1}))}};return(0,i.useEffect)(()=>(e0&&(eT(),eE(e=>({...e,isOpen:!1}))),()=>{if(a){let e=(0,K.createTabId)("sql",{id:e0});eu.updateTab(e,{scrollTop:eD.current})}}),[eT,e0]),(0,i.useEffect)(()=>{let t=t=>{if(ev||e_.isOpen)switch(t.key){case"Enter":("macos"===e?t.metaKey:t.ctrlKey)&&ev&&(tm(),eR());return;case"Escape":ev&&tp(),eR(),eq.current?.focus();return}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,ev,e_.isOpen,tm,tp,eR]),(0,i.useEffect)(()=>{if(ev){let e=eA.current,t=e?.getModel();if(t&&t.original&&t.modified){t.original.setValue(eC.original),t.modified.setValue(eC.modified);let s=e.getModifiedEditor(),a=e_.startLineNumber;s.revealLineInCenter(a)}}},[eS,eb]),(0,i.useEffect)(()=>{if(e5){let e=e8.find(e=>e.identifier===a);eg.setSelectedDatabaseId(e?.identifier)}},[e5,e8,a]),(0,i.useEffect)(()=>{if(void 0!==ep.diffContent){let{diffType:e,sql:t}=ep.diffContent,s=eq.current?.getModel();s&&(0===(eq.current?.getValue()??"").length?eq.current?.executeEdits("apply-ai-message",[{text:`${t}`,range:s.getFullModelRange()}]):(ey({original:eq.current?.getValue()||"",modified:t}),ew(e)))}},[ep.diffContent]),(0,i.useEffect)(()=>{if(ev){if(eA.current&&eK)return eY(!0),()=>eY(!1)}else eO(!1),eY(!1)},[ev,eK]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y,{visible:eF,hasDestructiveOperations:e$,hasUpdateWithoutWhere:eG,onCancel:()=>{eV(!1),eB(!1),eU(!1),setTimeout(()=>eq.current?.focus(),100)},onConfirm:()=>{eV(!1),ti(!0)}}),(0,t.jsx)("div",{className:"flex h-full",children:(0,t.jsxs)($.ResizablePanelGroup,{className:"relative",direction:"vertical",autoSaveId:d.LOCAL_STORAGE_KEYS.SQL_EDITOR_SPLIT_SIZE,children:[(0,t.jsx)($.ResizablePanel,{defaultSize:50,maxSize:70,children:(0,t.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:e3?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)(q.Loader2,{className:"animate-spin text-brand"})}):(0,t.jsxs)(t.Fragment,{children:[ev&&(0,t.jsxs)("div",{className:"w-full h-full",children:[(0,t.jsx)(td,{language:"pgsql",original:eC.original,modified:eC.modified,onMount:e=>{eA.current=e,eO(!0)}}),eH&&(0,t.jsx)(m.default,{editor:eA.current,id:"ask-ai-diff",value:eL,onChange:ek,onSubmit:e=>{tj(e,{beforeSelection:e_.beforeSelection,selection:e_.selection||eC.modified,afterSelection:e_.afterSelection})},onAccept:tm,onReject:tp,onCancel:eR,isDiffVisible:!0,isLoading:tx,startLineNumber:Math.max(0,e_.startLineNumber),endLineNumber:e_.endLineNumber})]}),(0,t.jsxs)("div",{className:"w-full h-full relative",children:[(0,t.jsx)(to,{autoFocus:!0,placeholder:e_.isOpen||eq.current?.getValue()?"":"Hit "+("macos"===e?"CMD+K":"CTRL+K")+" to generate query or just start typing",id:e0,snippetName:"new"===I?eZ:ep.snippets[e0]?.snippet.name??eZ,className:(0,F.cn)(ev&&"hidden"),editorRef:eq,monacoRef:eI,executeQuery:ti,onHasSelection:eP,onMount:e=>{let t=(0,K.createTabId)("sql",{id:e0}),s=eu.tabsMap[t];setTimeout(()=>{s?.metadata?.scrollTop&&e.setScrollTop(s.metadata.scrollTop)},20),e.onDidScrollChange(e=>eD.current=e.scrollTop)},onPrompt:({selection:e,beforeSelection:t,afterSelection:s,startLineNumber:a,endLineNumber:n})=>{eE(i=>({...i,isOpen:!0,selection:e,beforeSelection:t,afterSelection:s,startLineNumber:a,endLineNumber:n}))}}),eq.current&&e_.isOpen&&!ev&&(0,t.jsx)(m.default,{editor:eq.current,id:"ask-ai",value:eL,onChange:ek,onSubmit:e=>{tj(e,{beforeSelection:e_.beforeSelection,selection:e_.selection,afterSelection:e_.afterSelection})},onCancel:eR,isDiffVisible:!1,isLoading:tx,startLineNumber:Math.max(0,e_.startLineNumber),endLineNumber:e_.endLineNumber})]},e0)]})})}),(0,t.jsx)($.ResizableHandle,{withHandle:!0}),(0,t.jsx)($.ResizablePanel,{defaultSize:50,maxSize:70,children:e3?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)(q.Loader2,{className:"animate-spin text-brand"})}):(0,t.jsx)(tl,{id:e0,isExecuting:te,isExplainExecuting:ts,isDisabled:ev,hasSelection:eM,prettifyQuery:tn,executeQuery:ti,executeExplainQuery:tr,onDebug:th,buildDebugPrompt:tu,activeTab:eW,onActiveTabChange:eX})}),(0,t.jsx)("div",{className:"h-9",children:e2?.rows!==void 0&&!te&&(0,t.jsxs)(p.GridFooter,{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsxs)("p",{className:"text-xs",children:[(0,t.jsxs)("span",{className:"text-foreground",children:[e2.rows.length," row",e2.rows.length>1?"s":""]}),(0,t.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==e2.autoLimit&&` (Limited to only ${e2.autoLimit} rows)`})]})}),(0,t.jsx)(B.TooltipContent,{className:"max-w-xs",children:(0,t.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,t.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==e2.autoLimit&&(0,t.jsxs)(V.DropdownMenu,{children:[(0,t.jsx)(V.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(O.Button,{type:"default",iconRight:(0,t.jsx)(R.ChevronUp,{size:14}),children:["Limit results to:"," ",W.ROWS_PER_PAGE_OPTIONS.find(e=>e.value===ep.limit)?.label]})}),(0,t.jsx)(V.DropdownMenuContent,{className:"w-40",align:"end",children:(0,t.jsx)(V.DropdownMenuRadioGroup,{value:ep.limit.toString(),onValueChange:e=>ep.setLimit(Number(e)),children:W.ROWS_PER_PAGE_OPTIONS.map(e=>(0,t.jsx)(V.DropdownMenuRadioItem,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})]})};var tu=e.i(448710),th=e.i(569715),tm=e.i(795826),tp=e.i(79221),tx=e.i(326204),tg=e.i(853322),tf=e.i(990510);let tj=()=>{let e=(0,n.useRouter)(),{id:l,ref:o,content:d,skip:c}=(0,r.useParams)(),u=(0,s.usePrevious)(l),{data:h}=(0,v.useSelectedProjectQuery)(),m=(0,tm.useEditorType)(),p=(0,K.useTabsStateSnapshot)(),x=(0,z.useSqlEditorV2StateSnapshot)(),{history:g,setLastVisitedSnippet:f}=(0,tf.useDashboardHistory)(),j=(0,z.useSnippets)(o),b=j.find(e=>e.id===l),y=l?p.openTabs.find(e=>e.endsWith(l)):void 0,S=!!("new"!==l&&"function"==typeof x.addSnippet&&!b?.isNotSavedInDatabaseYet),{data:w,error:N,isError:C}=(0,tg.useContentIdQuery)({projectRef:o,id:l},{retry:!1,enabled:S}),_=C&&404===N.code&&N.message.includes("Content not found"),E=C&&400===N.code&&N.message.includes("Invalid uuid"),L=!!b&&_&&"new"===u&&"isNotSavedInDatabaseYet"in b;return((0,i.useEffect)(()=>{o&&w&&h&&(T.IS_PLATFORM&&w.project_id!==h.id?(f(void 0),e.push(`/project/${o}/sql/new`)):x.setSnippet(o,w))},[o,w,h]),(0,i.useEffect)(()=>{"new"===l&&"true"!==c&&void 0!==g.sql&&void 0===d&&void 0!==j.find(e=>e.id===g.sql)&&e.push(`/project/${o}/sql/${g.sql}`)},[l,j,d]),(0,i.useEffect)(()=>{if(!e.isReady||!l||"new"===l)return;let t=(0,K.createTabId)("sql",{id:l}),s=j.find(e=>e.id===l);p.addTab({id:t,type:"sql",label:s?.name||(0,W.generateSnippetTitle)(),metadata:{sqlId:l,name:s?.name}})},[e.isReady,l]),(_||E)&&!L)?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"w-[400px]",children:(0,t.jsx)(eR.Admonition,{type:"default",title:`Unable to find snippet with ID ${l}`,description:"This snippet doesn't exist in your project",children:y?(0,t.jsx)(O.Button,{type:"default",className:"mt-2",onClick:()=>{p.handleTabClose({id:y,router:e,editor:m,onClearDashboardHistory:()=>f(void 0)})},children:"Close tab"}):(0,t.jsx)(O.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>f(void 0),children:(0,t.jsx)(a.default,{href:`/project/${o}/sql`,children:"Head back"})})})})}):(0,t.jsx)(tc,{})};tj.getLayout=e=>(0,t.jsx)(tu.default,{children:(0,t.jsx)(th.EditorBaseLayout,{productMenu:(0,t.jsx)(tx.SQLEditorMenu,{}),product:"SQL Editor",children:(0,t.jsx)(tp.default,{children:e})})}),e.s(["default",0,tj],166926)},453513,(e,t,s)=>{let a="/project/[ref]/sql/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(166926)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})}]);

//# debugId=8170a09e-4533-54cd-13e4-cf4ffb2e7b29
//# sourceMappingURL=e217e10b3374185e.js.map